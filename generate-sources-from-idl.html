<html><head><title>Mu: Generating sources from IDL</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="47 Degrees" /><meta name="description" content="A purely functional library for building RPC endpoint-based services" /><meta name="og:image" content="/mu/img/poster.png" /><meta name="image" property="og:image" content="/mu/img/poster.png" /><meta name="og:title" content="Mu: Generating sources from IDL" /><meta name="title" property="og:title" content="Mu: Generating sources from IDL" /><meta name="og:site_name" content="Mu" /><meta name="og:url" content="https://higherkindness.github.io/mu/" /><meta name="og:type" content="website" /><meta name="og:description" content="A purely functional library for building RPC endpoint-based services" /><link rel="icon" type="image/png" href="/mu/img/favicon.png" /><meta name="twitter:title" content="Mu: Generating sources from IDL" /><meta name="twitter:image" content="/mu/img/poster.png" /><meta name="twitter:description" content="A purely functional library for building RPC endpoint-based services" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/mu/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/mu/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/mu/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/mu/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/mu/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/mu/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/mu/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/mu/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/mu/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/mu/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/mu/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/mu/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/mu/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/mu/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/mu/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/mu/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/mu/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/mu/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/mu/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/mu/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/mu/highlight/styles/default.css" /><link rel="stylesheet" href="/mu/css/style.css" /><link rel="stylesheet" href="/mu/css/palette.css" /><link rel="stylesheet" href="/mu/css/codemirror.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/mu/" class="brand"><div class="brand-wrapper"><span>Mu</span></div></a></li> <li><a href="/mu/" class="">Quickstart</a></li> <li><a href="/mu/core-concepts" class="">Core concepts</a></li> <li><a href="/mu/streaming" class="">Streaming</a></li> <li><a href="/mu/annotations" class="">Annotations</a></li> <li><a href="/mu/generate-sources-from-idl" class="">Generate sources from IDL</a> <ul class="sub_section"> <li><a href="/mu/generate-sources-from-avro" class="">Avro</a></li> <li><a href="/mu/generate-sources-from-proto" class="">Protocol Buffers</a></li></ul></li> <li><a href="/mu/idl-generation" class="">IDL Generation</a></li> <li><a href="/mu/patterns" class="">Patterns</a></li> <li><a href="/mu/ssl-tls" class="">SSL/TLS</a></li> <li><a href="/mu/metrics-reporting" class="">Metrics Reporting</a></li> <li><a href="/mu/decimal-migration-guide" class="">Migration guide for decimal types</a></li> <li><a href="/mu/schema-evolution" class="">Schema Evolution</a> <ul class="sub_section"> <li><a href="/mu/schema-evolution/avro" class="">Avro</a></li> <li><a href="/mu/schema-evolution/proto" class="">Protocol Buffers</a></li></ul></li> <li><a href="/mu/references" class="">References</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/higherkindness/mu"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/higherkindness/mu"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('Mu A purely functional library for building RPC endpoint-based services');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('Mu A purely functional library for building RPC endpoint-based services');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="higherkindness" data-github-repo="mu"><div class="content-wrapper"><section><h1 id="generate-sources-from-idl">Generate sources from IDL</h1>

<p>Since <code class="highlighter-rouge">Protobuf</code> and <code class="highlighter-rouge">Avro</code> are both a language-neutral, platform-neutral way of serializing structured data, 
our aim with <a href="https://github.com/higherkindness/mu">Mu</a> is to keep the compatibility and generate the Scala definitions (needed for working internally) from these IDL files. 
Before going into implementation details let’s see how to create the Scala files with our definitions.</p>

<p>Currently, <code class="highlighter-rouge">Avro</code> is supported in both <code class="highlighter-rouge">.avpr</code> (JSON) and <code class="highlighter-rouge">.avdl</code> (Avro IDL) formats, along with <code class="highlighter-rouge">Protobuf</code> (<code class="highlighter-rouge">.proto</code>).
The plugin’s implementation basically wraps the <a href="https://github.com/julianpeeters/avrohugger">avrohugger</a> library for <code class="highlighter-rouge">Avro</code> 
and uses <a href="https://github.com/higherkindness/skeuomorph/">skeuomorph</a> for <code class="highlighter-rouge">Protobuf</code> adding some Mu specific extensions. 
In the future, both (<code class="highlighter-rouge">Avro</code> and <code class="highlighter-rouge">Protobuf</code>) will be generated by <em>skeuomorph</em>.</p>

<h2 id="plugin-installation">Plugin Installation</h2>

<p>Add the following line to <em>project/plugins.sbt</em>:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">addSbtPlugin</span><span class="o">(</span><span class="s">"io.higherkindness"</span> <span class="o">%</span> <span class="s">"sbt-mu-idlgen"</span> <span class="o">%</span> <span class="s">"0.19.1"</span><span class="o">)</span>
</code></pre></div></div>

<p>Note that the plugin is only available for Scala 2.12.</p>

<h3 id="plugin-settings">Plugin Settings</h3>

<p>For generating <code class="highlighter-rouge">Scala</code> definitions we use <code class="highlighter-rouge">srcGen</code>. The easiest way to use the plugin is by integrating the source generation in your compile process adding this import to your <code class="highlighter-rouge">build.sbt</code> file:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">higherkindness.mu.rpc.idlgen.IdlGenPlugin.autoImport._</span>
</code></pre></div></div>
<p>and the setting,</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">idlType</span> <span class="o">:=</span> <span class="n">proto</span>  
<span class="n">sourceGenerators</span> <span class="n">in</span> <span class="nc">Compile</span> <span class="o">+=</span> <span class="o">(</span><span class="n">srcGen</span> <span class="n">in</span> <span class="nc">Compile</span><span class="o">).</span><span class="py">taskValue</span>
</code></pre></div></div>

<p>Otherwise, you can run the following sbt task (with the settings above in your <code class="highlighter-rouge">build.sbt</code>):</p>

<pre><code class="language-sbtshell">sbt
project foo
srcGen   
</code></pre>

<p>Note that <code class="highlighter-rouge">project foo</code> it’s only for multi-module projects.</p>

<p>There are a couple of key settings that can be configured according to various needs. In that case, you can add them like in the following example:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">idlType</span> <span class="o">:=</span> <span class="s">"proto"</span><span class="o">,</span>
<span class="n">srcGenTargetDir</span> <span class="o">:=</span> <span class="o">(</span><span class="nc">Compile</span> <span class="o">/</span> <span class="n">sourceManaged</span><span class="o">).</span><span class="py">value</span> <span class="o">/</span> <span class="s">"mu_proto"</span><span class="o">,</span>
<span class="n">srcGenSerializationType</span> <span class="o">:=</span> <span class="s">"Protobuf"</span><span class="o">,</span>
<span class="n">sourceGenerators</span> <span class="n">in</span> <span class="nc">Compile</span> <span class="o">+=</span> <span class="o">(</span><span class="n">srcGen</span> <span class="n">in</span> <span class="nc">Compile</span><span class="o">).</span><span class="py">taskValue</span>
</code></pre></div></div>

<p>In the example above we are using <code class="highlighter-rouge">proto</code> files with <code class="highlighter-rouge">Protobuf</code> serialization. 
The plugin generates them in <code class="highlighter-rouge">target/scala-2.12/src_managed/main/mu_proto</code>.</p>

<p>Basic settings:</p>

<ul>
  <li><strong><code class="highlighter-rouge">idlType</code></strong>: the type of IDL to be generated, either <code class="highlighter-rouge">proto</code> or <code class="highlighter-rouge">avro</code>.</li>
  <li><strong><code class="highlighter-rouge">srcGenSerializationType</code></strong>: the serialization type when generating Scala sources from the IDL definitions. <code class="highlighter-rouge">Protobuf</code>, <code class="highlighter-rouge">Avro</code> or <code class="highlighter-rouge">AvroWithSchema</code>(see <a href="schema-evolution/avro">Schema evolution/Avro</a>) are the current supported serialization types. By default, the serialization type is ‘Avro’.</li>
  <li><strong><code class="highlighter-rouge">srcGenSourceDirs</code></strong>: the list of directories where your IDL files are placed. By default: <code class="highlighter-rouge">Compile / resourceDirectory</code>, typically <code class="highlighter-rouge">src/main/resources/</code>.</li>
  <li><strong><code class="highlighter-rouge">srcGenIDLTargetDir</code></strong>: the target directory where all the IDL files specified in <code class="highlighter-rouge">srcGenSourceDirs</code> will be copied. Given this configuration, the plugin will automatically copy the following to this target directory:
    <ul>
      <li>All the definitions extracted from the different <code class="highlighter-rouge">jar</code> or <code class="highlighter-rouge">sbt</code> modules, and also,</li>
      <li>All the source folders specified in the <code class="highlighter-rouge">srcGenSourceDirs</code> setting.</li>
    </ul>
  </li>
  <li><strong><code class="highlighter-rouge">srcGenTargetDir</code></strong>: the Scala target directory, where the <code class="highlighter-rouge">srcGen</code> task will write the generated files in subpackages based on the namespaces declared in the IDL files. By default, <code class="highlighter-rouge">Compile / sourceManaged</code>, tipically  <code class="highlighter-rouge">target/scala-2.12/src_managed/main/</code>.</li>
</ul>

<p><strong>Note</strong>: The source directory must exist. Target directories will be created upon generation.</p>

<p>Extra settings:</p>

<ul>
  <li><strong><code class="highlighter-rouge">srcGenJarNames</code></strong>: the list of jar names or sbt modules containing the IDL definitions that will be used at compilation time by <code class="highlighter-rouge">srcGen</code> to generate the Scala sources. By default, this sequence is empty.</li>
  <li><strong><code class="highlighter-rouge">idlGenBigDecimal</code></strong>: specifies how the <code class="highlighter-rouge">decimal</code> types will be generated. <code class="highlighter-rouge">ScalaBigDecimalGen</code> produces <code class="highlighter-rouge">scala.math.BigDecimal</code> and <code class="highlighter-rouge">ScalaBigDecimalTaggedGen</code> produces <code class="highlighter-rouge">scala.math.BigDecimal</code> but tagged with the ‘precision’ and ‘scale’. i.e. <code class="highlighter-rouge">scala.math.BigDecimal @@ (Nat._8, Nat._2)</code>. By default <code class="highlighter-rouge">ScalaBigDecimalTaggedGen</code>.</li>
  <li><strong><code class="highlighter-rouge">idlGenMarshallerImports</code></strong>: additional imports to add on top to the generated service files. This property can be used for importing extra codecs for your services. By default:
    <ul>
      <li><code class="highlighter-rouge">List(BigDecimalAvroMarshallers, JavaTimeDateAvroMarshallers)</code> if <code class="highlighter-rouge">srcGenSerializationType</code> is <code class="highlighter-rouge">Avro</code> or <code class="highlighter-rouge">AvroWithSchema</code> and <code class="highlighter-rouge">idlGenBigDecimal</code> is <code class="highlighter-rouge">ScalaBigDecimalGen</code></li>
      <li><code class="highlighter-rouge">List(BigDecimalTaggedAvroMarshallers, JavaTimeDateAvroMarshallers)</code> if <code class="highlighter-rouge">srcGenSerializationType</code> is <code class="highlighter-rouge">Avro</code> or <code class="highlighter-rouge">AvroWithSchema</code> and <code class="highlighter-rouge">idlGenBigDecimal</code> is <code class="highlighter-rouge">ScalaBigDecimalTaggedGen</code></li>
      <li><code class="highlighter-rouge">List(BigDecimalProtobufMarshallers, JavaTimeDateProtobufMarshallers)</code> if <code class="highlighter-rouge">srcGenSerializationType</code> is <code class="highlighter-rouge">Protobuf</code>.</li>
    </ul>
  </li>
  <li><strong><code class="highlighter-rouge">idlGenCompressionType</code></strong>: Specifies the compression type that will be used by the IDL generated services. Set to <code class="highlighter-rouge">higherkindness.mu.rpc.idlgen.Model.GzipGen</code> for compressed communications with Gzip. <code class="highlighter-rouge">higherkindness.mu.rpc.idlgen.Model.NoCompressionGen</code> by default.</li>
  <li><strong><code class="highlighter-rouge">idlGenIdiomaticEndpoints</code></strong>: Flag indicating if idiomatic gRPC endpoints should be used. If <code class="highlighter-rouge">true</code>, the service operations will be prefixed by the namespace and the methods will be capitalized. <code class="highlighter-rouge">false</code> by default.</li>
</ul>

<p>The <code class="highlighter-rouge">JodaDateTimeAvroMarshallers</code> and <code class="highlighter-rouge">JodaDateTimeProtobufMarshallers</code> are also available, but they need the dependency <code class="highlighter-rouge">mu-rpc-marshallers-jodatime</code>. 
You can also specify custom imports with the following:</p>
<ul>
  <li><code class="highlighter-rouge">idlGenMarshallerImports := List(higherkindness.mu.rpc.idlgen.Model.CustomMarshallersImport("com.sample.marshallers._"))</code></li>
  <li>See the <a href="core-concepts#custom-codecs">Custom codecs section in core concepts</a> for more information.</li>
</ul>

<p>You can even use <code class="highlighter-rouge">IDL</code> definitions packaged into artifacts within your classpath. 
In that particular situation, you need to setup <code class="highlighter-rouge">srcGenJarNames</code>, 
specifying the artifact names (or sbt module names) that will be unzipped/used to extract the <code class="highlighter-rouge">IDL</code> files.</p>

<p><code class="highlighter-rouge">srcGenJarNames </code> can be very useful when you want to distribute your <code class="highlighter-rouge">IDL</code> files 
without binary code (to prevent binary conflicts in clients).</p>

<p><em>Note</em>: regarding <code class="highlighter-rouge">srcGenSourceDirs</code>, all the directories configured as sources 
will be distributed in the resulting jar artifact preserving the same folder structure as in the source.</p>

<p>The following example shows how to set up a dependency with another artifact or sbt module containing the IDL definitions (<code class="highlighter-rouge">foo-domain</code>):</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//...
</span><span class="o">.</span><span class="py">settings</span><span class="o">(</span>
  <span class="nc">Seq</span><span class="o">(</span>
      <span class="n">idlType</span> <span class="o">:=</span> <span class="s">"avro"</span><span class="o">,</span>
      <span class="n">srcGenSerializationType</span> <span class="o">:=</span> <span class="s">"AvroWithSchema"</span><span class="o">,</span>
      <span class="n">srcGenJarNames</span> <span class="o">:=</span> <span class="nc">Seq</span><span class="o">(</span><span class="s">"foo-domain"</span><span class="o">),</span>
      <span class="n">srcGenTargetDir</span> <span class="o">:=</span> <span class="o">(</span><span class="nc">Compile</span> <span class="o">/</span> <span class="n">sourceManaged</span><span class="o">).</span><span class="py">value</span> <span class="o">/</span> <span class="s">"compiled_avro"</span><span class="o">,</span>
      <span class="n">sourceGenerators</span> <span class="n">in</span> <span class="nc">Compile</span> <span class="o">+=</span> <span class="o">(</span><span class="nc">Compile</span> <span class="o">/</span> <span class="n">srcGen</span><span class="o">).</span><span class="py">taskValue</span><span class="o">,</span>
      <span class="n">libraryDependencies</span> <span class="o">++=</span> <span class="nc">Seq</span><span class="o">(</span>
        <span class="s">"io.higherkindness"</span> <span class="o">%%</span> <span class="s">"mu-rpc-channel"</span> <span class="o">%</span> <span class="nv">V</span><span class="o">.</span><span class="py">muRPC</span>
      <span class="o">)</span>
  <span class="o">)</span>
<span class="o">)</span>
<span class="c1">//...
</span></code></pre></div></div>

<h2 id="generating-sources">Generating sources</h2>

<p>Let’s suppose a <code class="highlighter-rouge">proto</code> file like</p>

<div class="language-proto highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">syntax</span> <span class="o">=</span> <span class="s">"proto3"</span><span class="p">;</span>

<span class="kn">package</span> <span class="nn">foo</span><span class="o">.</span><span class="n">bar</span><span class="p">;</span>

<span class="kd">message</span> <span class="nc">HelloRequest</span> <span class="p">{</span>
  <span class="kt">string</span> <span class="na">arg1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">string</span> <span class="na">arg2</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="k">repeated</span> <span class="kt">string</span> <span class="na">arg3</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">HelloResponse</span> <span class="p">{</span>
  <span class="kt">string</span> <span class="na">arg1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">string</span> <span class="na">arg2</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="k">repeated</span> <span class="kt">string</span> <span class="na">arg3</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">service</span> <span class="n">ProtoGreeter</span> <span class="p">{</span>
  <span class="k">rpc</span> <span class="n">SayHelloProto</span> <span class="p">(</span><span class="n">HelloRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">HelloResponse</span><span class="p">);</span>
  <span class="k">rpc</span> <span class="n">LotsOfRepliesProto</span> <span class="p">(</span><span class="n">HelloRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">stream</span> <span class="n">HelloResponse</span><span class="p">);</span>
  <span class="k">rpc</span> <span class="n">LotsOfGreetingsProto</span> <span class="p">(</span><span class="n">stream</span> <span class="n">HelloRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">HelloResponse</span><span class="p">);</span>
  <span class="k">rpc</span> <span class="n">BidiHelloProto</span> <span class="p">(</span><span class="n">stream</span> <span class="n">HelloRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">stream</span> <span class="n">HelloResponse</span><span class="p">);</span>
  <span class="k">rpc</span> <span class="n">BidiHelloFs2Proto</span> <span class="p">(</span><span class="n">stream</span> <span class="n">HelloRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">stream</span> <span class="n">HelloResponse</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>As you can see, we are defining two case classes, <code class="highlighter-rouge">HelloRequest</code> and <code class="highlighter-rouge">HelloResponse</code>, and a service, <code class="highlighter-rouge">ProtoGreeter</code>. 
 Therefore, the generated scala definition is</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="nn">foo.bar</span>
<span class="k">import</span> <span class="nn">higherkindness.mu.rpc.protocol._</span>
<span class="k">import</span> <span class="nn">fs2.Stream</span>
<span class="k">import</span> <span class="nn">shapeless.</span><span class="o">{:+:,</span> <span class="nc">CNil</span><span class="o">}</span>

<span class="k">object</span> <span class="nc">GreeterService</span> <span class="o">{</span> 

<span class="nd">@message</span> <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">HelloRequest</span><span class="o">(</span><span class="n">arg1</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">arg2</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">arg3</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span>

<span class="nd">@message</span> <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">HelloResponse</span><span class="o">(</span><span class="n">arg1</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">arg2</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">arg3</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span>

  <span class="nd">@service</span><span class="o">(</span><span class="nc">Protobuf</span><span class="o">)</span> <span class="k">trait</span> <span class="nc">ProtoGreeter</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="nf">SayHelloProto</span><span class="o">(</span><span class="n">req</span><span class="k">:</span> <span class="kt">HelloRequest</span><span class="o">)</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">HelloResponse</span><span class="o">]</span>
    <span class="k">def</span> <span class="nf">LotsOfRepliesProto</span><span class="o">(</span><span class="n">req</span><span class="k">:</span> <span class="kt">HelloRequest</span><span class="o">)</span><span class="k">:</span> <span class="kt">Stream</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">HelloResponse</span><span class="o">]</span>
    <span class="k">def</span> <span class="nf">LotsOfGreetingsProto</span><span class="o">(</span><span class="n">req</span><span class="k">:</span> <span class="kt">Stream</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">HelloRequest</span><span class="o">])</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">HelloResponse</span><span class="o">]</span>
    <span class="k">def</span> <span class="nf">BidiHelloProto</span><span class="o">(</span><span class="n">req</span><span class="k">:</span> <span class="kt">Stream</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">HelloRequest</span><span class="o">])</span><span class="k">:</span> <span class="kt">Stream</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">HelloResponse</span><span class="o">]</span>
    <span class="k">def</span> <span class="nf">BidiHelloFs2Proto</span><span class="o">(</span><span class="n">req</span><span class="k">:</span> <span class="kt">Stream</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">HelloRequest</span><span class="o">])</span><span class="k">:</span> <span class="kt">Stream</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">HelloResponse</span><span class="o">]</span>
  <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>Note that Scala case class is preceded by the <code class="highlighter-rouge">@message</code> annotation. It’s generated by <code class="highlighter-rouge">srcGen</code> but not necessary for <a href="https://github.com/higherkindness/mu">Mu</a>.</p>

<p>Also, we can use <code class="highlighter-rouge">avro</code>. From an <code class="highlighter-rouge">.avpr</code>:</p>

<pre><code class="language-avroidl">{
  "namespace" : "foo.bar",
  "protocol" : "MyGreeterService",
  "types" : [
    {
      "name" : "HelloRequest",
      "type" : "record",
      "fields" : [
        {
          "name" : "arg1",
          "type" : "string"
        },
        {
          "name" : "arg2",
          "type" : [
            "null",
            "string"
          ]
        },
        {
          "name" : "arg3",
          "type" : {
            "type" : "array",
            "items" : "string"
          }
        }
      ]
    },
    {
      "name" : "HelloResponse",
      "type" : "record",
      "fields" : [
        {
          "name" : "arg1",
          "type" : "string"
        },
        {
          "name" : "arg2",
          "type" : [
            "null",
            "string"
          ]
        },
        {
          "name" : "arg3",
          "type" : {
            "type" : "array",
            "items" : "string"
          }
        }
      ]
    }
  ],
  "messages" : {
    "sayHelloAvro" : {
      "request" : [
        {
          "name" : "arg",
          "type" : "HelloRequest"
        }
      ],
      "response" : "HelloResponse"
    },
    "sayNothingAvro" : {
      "request" : [
      ],
      "response" : "null"
    }
  }
}

</code></pre>
<p>or <code class="highlighter-rouge">.avdl</code>:</p>

<pre><code class="language-avroidl">@namespace("foo.bar")
protocol MyGreeterService{

    record HelloRequest {
        string arg1;
        union { null, string } arg2;
        array&lt;string&gt; arg3;
    }

    record HelloResponse {
        string arg1;
        union { null, string } arg2;
        array&lt;string&gt;  arg3;
    }

    foo.bar.HelloResponse sayHelloAvro(foo.bar.HelloRequest arg);

    void sayNothingAvro();
}
</code></pre>

<p>We’ll get the same service:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="nn">foo.bar</span>

<span class="k">import</span> <span class="nn">higherkindness.mu.rpc.internal.encoders.avro.bigDecimalTagged._</span>
<span class="k">import</span> <span class="nn">higherkindness.mu.rpc.internal.encoders.avro.javatime._</span>
<span class="k">import</span> <span class="nn">higherkindness.mu.rpc.protocol._</span>

<span class="nd">@message</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">HelloRequest</span><span class="o">(</span><span class="n">arg1</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">arg2</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">String</span><span class="o">],</span> <span class="n">arg3</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span>

<span class="nd">@message</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">HelloResponse</span><span class="o">(</span><span class="n">arg1</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">arg2</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">String</span><span class="o">],</span> <span class="n">arg3</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span>

<span class="nd">@service</span><span class="o">(</span><span class="nc">Avro</span><span class="o">)</span> <span class="k">trait</span> <span class="nc">MyGreeterService</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span> <span class="o">{</span>

  <span class="k">def</span> <span class="nf">sayHelloAvro</span><span class="o">(</span><span class="n">arg</span><span class="k">:</span> <span class="kt">foo.bar.HelloRequest</span><span class="o">)</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">foo.bar.HelloResponse</span><span class="o">]</span>

  <span class="k">def</span> <span class="nf">sayNothingAvro</span><span class="o">(</span><span class="n">arg</span><span class="k">:</span> <span class="kt">Empty.</span><span class="k">type</span><span class="o">)</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">Empty.</span><span class="k">type</span><span class="o">]</span>

<span class="o">}</span>
</code></pre></div></div>

</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/mu/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlighting();
              </script><script>((window.gitter = {}).chat = {}).options = {
room: '47deg/mu'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/mu/js/main.js"></script></body></html>